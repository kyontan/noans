!!!HTML5
%html{ :lang => "ja" }
	%title 真実はいつも解なし
	%meta{ 'http-equiv' => "Content-Type", :content => "text/html; charset=UTF-8" }
	/ %meta{ :name => "viewport", :content => "width=device-width, initial-scale=0.5, maximum-scale=2, user-scalable=yes"}
	%meta{ :name => "viewport", :content => "width=device-width, user-scalable=yes"}
	
	%base{ :href => "http://test.monora.me/rack/noans/"}
	
	%link{ :rel => "apple-touch-icon-precomposed", :href => "./apple-touch-icon-precomposed.png", :sizes => "114x114" }
	%link{ :rel => "shortcut icon", :href => "./apple-touch-icon-precomposed.png" }
	
	%link{ :rel => "stylesheet", :href => "./reset.css" }
	%link{ :rel => "stylesheet", :href => "./index.css" }
	
	%script{ :src => "./jquery-1.7.2.min.js" }
	%script{ :src => "./sha256.js" }

	-#:javascript
	%script
		:plain
			$(document).ready(function(){
				$.ajax({
					url:"./api.rb?mode=getpost&num=5", 
					dataType: "json", 
					success: function(data,status){
						$.each(data, function(i, item){
							var time = item["time"].substring(0,10).replace(/-/g,"/") + ' ' + item["time"].substring(11,16);
							$("#posts").append(time + ": " + item["data"] + "<br>");
						});
					}
				});
				
				$.get("//hst.monora.me/counter/counter.rb", function(data){ $("#count").append(data); });
				$.get("./api.rb?mode=gettext", function(data){
					$("#karitext textarea").val(data["data"]);
					$("#karipost").append(data["data"]);
				});
				
				$(function () {
				  var supportsInputAttribute = function (attr) {
				  var input = document.createElement('input');
				  return attr in input;
				};
				  
			  if (!supportsInputAttribute('placeholder')) {
					$('[placeholder]').each(function () {
						var input = $(this),
					  placeholderText = input.attr('placeholder'),
					  placeholderColor = 'GrayText',
					  defaultColor = input.css('color');
					  
					  input.focus(function () {
					  	if (input.val() === placeholderText) { input.val('').css('color', defaultColor); }
					  }).blur(function () {
					  	if (input.val() === '') { input.val(placeholderText).css('color', placeholderColor); }
					  	else if (input.val() === placeholderText) {
					  		input.css('color', placeholderColor);
					  	}
					  }).blur().parents('form'). submit(function () {
					  	if (input.val() === placeholderText) { input.val(''); }
					  });
					 });
					}
				});
	
			});
			
			function convert_pass(){
			  document.loginform.pass.value = SHA256(document.loginform.pass.value);
			  return true;
			}
			
			function convert_newac(){
			  document.registerform.pass.value = SHA256(document.loginform.pass.value);
			  alert("登録処理しました。ログインしてみてね。");
			  return true;
			}
			
			if (navigator.userAgent.indexOf('Android') > 0) {
				$(window).bind('resize load', function(){
					$("html").css("zoom" , $(window).width()/640 );
				});
			}
		
	-#:javascript
	%script
		:plain
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-20839690-6']); 
			_gaq.push(['_setDomainName', 'monora.me']);
			_gaq.push(['_trackPageview']);
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
	
	%header
		%span#title 真実はいつも解なし
		#right
			- user = "kyontan"
			%span#username #{user} でログイン中
			%br
			%a#logout{ :href => "/?mode=logout"} ログアウト
	
	

	= haml @obje
		
	.posts
	
	%hr
	
	#karipost
	
	%footer<
		%span#count アクセス
		%span#author 作った人のTwitter:hinokyon
